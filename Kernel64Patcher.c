/*
* Copyright 2020, @Ralph0045
* gcc Kernel64Patcher.c -o Kernel64Patcher
*/

#if defined(__linux__) || defined(__gnu_linux__)
    #define _GNU_SOURCE
#endif

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stddef.h>
#include <stdbool.h>

#include "patchfinder64.c"
#include "patchfinder64_friedappleteam.c"

#define GET_OFFSET(kernel_len, x) (x - (uintptr_t) kernel_buf)
#define GET_OFFSET2(kernel_len, x) (x + (uintptr_t) kernel_buf)

#define LSL0 0
#define LSL16 16
#define LSL32 32

#define _PAGEOFF(x) ((x) & 0xFFFFF000)

#define _ADRP(r, o) (0x90000000 | ((((o) >> 12) & 0x3) << 29) | ((((o) >> 12) & 0x1FFFFC) << 3) | ((r) & 0x1F))
#define _BL(a, o) (0x94000000 | ((((o) - (a)) >> 2) & 0x3FFFFFF))
#define _B(a, o) (0x14000000 | ((((o) - (a)) >> 2) & 0x3FFFFFF))
#define _MOVKX(r, i, s) (0xF2800000 | (((s) & 0x30) << 17) | (((i) & 0xFFFF) << 5) | ((r) & 0x1F))
#define _MOVZX(r, i, s) (0xD2800000 | (((s) & 0x30) << 17) | (((i) & 0xFFFF) << 5) | ((r) & 0x1F))
#define _MOVZW(r, i, s) (0x52800000 | (((s) & 0x30) << 17) | (((i) & 0xFFFF) << 5) | ((r) & 0x1F))
#define _NOP() 0xD503201F

// iOS 7 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios7(void* kernel_buf,size_t kernel_len, addr_t mkb) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search fd7bbfa9fd030091ff4300d100008052a11300d1
    uint8_t search[] = { 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xff, 0x43, 0x00, 0xd1, 0x00, 0x00, 0x80, 0x52, 0xa1, 0x13, 0x00, 0xd1 };
    void* ent_loc = memmem(kernel_buf+mkb, kernel_len-mkb, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 7 arm64
int get__MKBGetDeviceLockState_patch_ios7(void* kernel_buf,size_t kernel_len, addr_t mkb) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search fd7bbfa9fd030091f44fbfa9ff4300d1ff0f00b9
    uint8_t search[] = { 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xf4, 0x4f, 0xbf, 0xa9, 0xff, 0x43, 0x00, 0xd1, 0xff, 0x0f, 0x00, 0xb9 };
    void* ent_loc = memmem(kernel_buf+mkb, kernel_len-mkb, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 8 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios8(void* kernel_buf,size_t kernel_len, addr_t mkb) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search fd7bbfa9fd030091ff4300d100008052
    uint8_t search[] = { 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xff, 0x43, 0x00, 0xd1, 0x00, 0x00, 0x80, 0x52 };
    void* ent_loc = memmem(kernel_buf+mkb, kernel_len-mkb, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 8 arm64
int get__MKBGetDeviceLockState_patch_ios8(void* kernel_buf,size_t kernel_len, addr_t mkb) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search f44fbea9fd7b01a9fd430091ff4300d1ff0f00b9
    uint8_t search[] = { 0xf4, 0x4f, 0xbe, 0xa9, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xff, 0x43, 0x00, 0xd1, 0xff, 0x0f, 0x00, 0xb9 };
    void* ent_loc = memmem(kernel_buf+mkb, kernel_len-mkb, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 9 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios9(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search c862483968000034f303003219000014
    uint8_t search[] = { 0x68, 0x00, 0x00, 0x34, 0xe0, 0x03, 0x00, 0x32 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    addr_t beg_func = (addr_t)find_last_insn_matching_64(0, kernel_buf, kernel_len, ent_loc, insn_is_funcbegin_64);
    if(!beg_func) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" funcbegin insn\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" funcbegin insn at %p\n", __FUNCTION__,(void*)(beg_func));
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,beg_func));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, beg_func);
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 9 arm64
int get__MKBGetDeviceLockState_patch_ios9(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search fd7bbfa9fd030091ffc300d1ff530079ffff01a9ffff00a9ff0300f9
    uint8_t search[] = { 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xff, 0xc3, 0x00, 0xd1, 0xff, 0x53, 0x00, 0x79, 0xff, 0xff, 0x01, 0xa9, 0xff, 0xff, 0x00, 0xa9, 0xff, 0x03, 0x00, 0xf9 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 10 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios10(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search 68000034f303003219000014
    uint8_t search[] = { 0x68, 0x00, 0x00, 0x34, 0xf3, 0x03, 0x00, 0x32, 0x19, 0x00, 0x00, 0x14 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x1C; // move to funcbegin
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 10 arm64
int get__MKBGetDeviceLockState_patch_ios10(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search fd7bbfa9fd030091ffc300d1ff530079ffff01a9ffff00a9ff0300f9
    uint8_t search[] = { 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xff, 0xc3, 0x00, 0xd1, 0xff, 0x53, 0x00, 0x79, 0xff, 0xff, 0x01, 0xa9, 0xff, 0xff, 0x00, 0xa9, 0xff, 0x03, 0x00, 0xf9 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 10.3 arm64
int get__MKBGetDeviceLockState_patch_ios103(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search ff0301d1fd7b03a9fdc30091ff530079ffff01a9ffff00a9ff0300f9e1030091
    uint8_t search[] = { 0xff, 0x03, 0x01, 0xd1, 0xfd, 0x7b, 0x03, 0xa9, 0xfd, 0xc3, 0x00, 0x91, 0xff, 0x53, 0x00, 0x79, 0xff, 0xff, 0x01, 0xa9, 0xff, 0xff, 0x00, 0xa9, 0xff, 0x03, 0x00, 0xf9, 0xe1, 0x03, 0x00, 0x91 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 11 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios11(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search 68000034f303003219000014
    uint8_t search[] = { 0x68, 0x00, 0x00, 0x34, 0xf3, 0x03, 0x00, 0x32, 0x19, 0x00, 0x00, 0x14 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x1C; // move to funcbegin
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 11 arm64
int get__MKBGetDeviceLockState_patch_ios11(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search e80740b91f0000710001801afd7b43a9ff030191c0035fd6
    uint8_t search[] = { 0xe8, 0x07, 0x40, 0xb9, 0x1f, 0x00, 0x00, 0x71, 0x00, 0x01, 0x80, 0x1a, 0xfd, 0x7b, 0x43, 0xa9, 0xff, 0x03, 0x01, 0x91, 0xc0, 0x03, 0x5f, 0xd6 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x24; // move to funcbegin
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 12 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios12(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search 68000034f303003219000014
    uint8_t search[] = { 0x68, 0x00, 0x00, 0x34, 0xf3, 0x03, 0x00, 0x32, 0x19, 0x00, 0x00, 0x14 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x1C; // move to funcbegin
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 12 arm64
int get__MKBGetDeviceLockState_patch_ios12(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search e80740b91f0000710001801afd7b43a9ff030191c0035fd6
    uint8_t search[] = { 0xe8, 0x07, 0x40, 0xb9, 0x1f, 0x00, 0x00, 0x71, 0x00, 0x01, 0x80, 0x1a, 0xfd, 0x7b, 0x43, 0xa9, 0xff, 0x03, 0x01, 0x91, 0xc0, 0x03, 0x5f, 0xd6 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x24; // move to funcbegin
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 13 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios13(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search 68000034f303003219000014
    uint8_t search[] = { 0x68, 0x00, 0x00, 0x34, 0xf3, 0x03, 0x00, 0x32, 0x19, 0x00, 0x00, 0x14 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x1C; // move to funcbegin
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 13.4 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios134(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search 680000343300805219000014
    uint8_t search[] = { 0x68, 0x00, 0x00, 0x34, 0x33, 0x00, 0x80, 0x52, 0x19, 0x00, 0x00, 0x14 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x1C; // move to funcbegin
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 13 arm64
int get__MKBGetDeviceLockState_patch_ios13(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search ff0301d1fd7b03a9fdc3009100e4004fe0a3813ce00300ade1030091
    uint8_t search[] = { 0xff, 0x03, 0x01, 0xd1, 0xfd, 0x7b, 0x03, 0xa9, 0xfd, 0xc3, 0x00, 0x91, 0x00, 0xe4, 0x00, 0x4f, 0xe0, 0xa3, 0x81, 0x3c, 0xe0, 0x03, 0x00, 0xad, 0xe1, 0x03, 0x00, 0x91 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 14 arm64
int get__MKBDeviceUnlockedSinceBoot_patch_ios14(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search 6800003433008052
    uint8_t search[] = { 0x68, 0x00, 0x00, 0x34, 0x33, 0x00, 0x80, 0x52 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBDeviceUnlockedSinceBoot\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBDeviceUnlockedSinceBoot\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    xref_stuff = xref_stuff - 0x1C; // move to funcbegin
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800020; // mov w0, 0x1
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBDeviceUnlockedSinceBoot\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

// iOS 14 arm64
int get__MKBGetDeviceLockState_patch_ios14(void* kernel_buf,size_t kernel_len, addr_t _convertAKSErrorToMKB, addr_t _debuglog) {
    printf("%s: Entering ...\n",__FUNCTION__);
    // search ff0301d1fd7b03a9fdc3009100e4004fe0a3813ce00300ade1030091
    uint8_t search[] = { 0xff, 0x03, 0x01, 0xd1, 0xfd, 0x7b, 0x03, 0xa9, 0xfd, 0xc3, 0x00, 0x91, 0x00, 0xe4, 0x00, 0x4f, 0xe0, 0xa3, 0x81, 0x3c, 0xe0, 0x03, 0x00, 0xad, 0xe1, 0x03, 0x00, 0x91 };
    void* ent_loc = memmem(kernel_buf+_debuglog, kernel_len-_debuglog, search, sizeof(search) / sizeof(*search));
    if (!ent_loc) {
        printf("%s: Could not find \"_MKBGetDeviceLockState\" patch\n",__FUNCTION__);
        return -1;
    }
    printf("%s: Found \"_MKBGetDeviceLockState\" patch loc at %p\n",__FUNCTION__,GET_OFFSET(kernel_len,ent_loc));
    addr_t xref_stuff = (addr_t)GET_OFFSET(kernel_len, ent_loc);
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0x52800060; // mov w0, 0x3
    xref_stuff = xref_stuff + 0x4;
    printf("%s: Patching \"_MKBGetDeviceLockState\" at %p\n", __FUNCTION__,(void*)(xref_stuff));
    *(uint32_t *) (kernel_buf + xref_stuff) = 0xD65F03C0; // ret
    xref_stuff = xref_stuff + 0x4;
    return 0;
}

int main(int argc, char **argv) {
    
    printf("%s: Starting...\n", __FUNCTION__);
    
    FILE* fp = NULL;
    
    if(argc < 4){
        printf("Usage: %s <dyld_shared_cache_arm64_in> <dyld_shared_cache_arm64_out> <args>\n",argv[0]);
        printf("\t-7\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 7 Only)\n");
        printf("\t-8\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 8 Only)\n");
        printf("\t-9\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 9 Only)\n");
        printf("\t-10\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 10.0-10.2.1 Only)\n");
        printf("\t-103\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 10.3-10.3.3 Only)\n");
        printf("\t-11\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 11.0-11.2.6 Only)\n");
        printf("\t-113\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 11.3-11.4.1 Only)\n");
        printf("\t-12\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 12.0-12.1.2 Only)\n");
        printf("\t-122\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 12.2-12.5.7 Only)\n");
        printf("\t-13\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 13.0-13.3.1 Only)\n");
        printf("\t-134\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 13.4-13.7 Only)\n");
        printf("\t-14\t\tPatch _MKBDeviceUnlockedSinceBoot (iOS 14.0-14.7.1 Only)\n");
        return 0;
    }
    
    void* kernel_buf;
    size_t kernel_len;
    
    char *filename = argv[1];
    
    fp = fopen(argv[1], "rb");
    if(!fp) {
        printf("%s: Error opening %s!\n", __FUNCTION__, argv[1]);
        return -1;
    }
    
    fseek(fp, 0, SEEK_END);
    kernel_len = ftell(fp);
    fseek(fp, 0, SEEK_SET);
    
    kernel_buf = (void*)malloc(kernel_len);
    if(!kernel_buf) {
        printf("%s: Out of memory!\n", __FUNCTION__);
        fclose(fp);
        return -1;
    }
    
    fread(kernel_buf, 1, kernel_len, fp);
    fclose(fp);
    
    if(memmem(kernel_buf,kernel_len,"KernelCacheBuilder",18)) {
        printf("%s: Detected IMG4/IM4P, you have to unpack and decompress it!\n",__FUNCTION__);
        return -1;
    }
    
    init_kernel(0, filename);
    
    for(int i=0;i<argc;i++) {
        if(strcmp(argv[i], "-7") == 0) {
            uint8_t search[] = { 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xff, 0x43, 0x00, 0xd1, 0xe8, 0xff, 0xa3, 0x12, 0x08, 0x58, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x88, 0x00, 0x00, 0x54, 0x08, 0x00, 0x80, 0x52, 0xc0, 0x04, 0x00, 0x35, 0x2b, 0x00, 0x00, 0x14, 0xe8, 0xff, 0xa3, 0x12, 0xe8, 0x5d, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x08, 0x02, 0x00, 0x54, 0xe8, 0x7b, 0x1f, 0x32, 0xe9, 0xff, 0xa3, 0x12, 0x29, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x28, 0x02, 0x00, 0x54, 0xe9, 0xff, 0xa3, 0x12, 0x29, 0x58, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xc0, 0x03, 0x00, 0x54, 0xe8, 0xff, 0xa3, 0x12, 0x28, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc1, 0x01, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x18, 0x00, 0x00, 0x14, 0xe8, 0xff, 0xa3, 0x12, 0x08, 0x5e, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc1, 0x01, 0x00, 0x54, 0xe8, 0x73, 0x1d, 0x32, 0x12, 0x00, 0x00, 0x14, 0xe9, 0xff, 0xa3, 0x12, 0x49, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xc0, 0x01, 0x00, 0x54, 0x07, 0x00, 0x00, 0x14, 0xe8, 0xff, 0xa3, 0x12, 0xc8, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x61, 0x00, 0x00, 0x54, 0xe8, 0x7b, 0x1e, 0x32, 0x07, 0x00, 0x00, 0x14, 0xe0, 0x03, 0x00, 0xf9 };
            void* ent_loc = memmem(kernel_buf, kernel_len, search, sizeof(search) / sizeof(*search));
            if (!ent_loc) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\"\n",__FUNCTION__);
                return -1;
            }
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios7(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, ent_loc));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios7(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, ent_loc));
        }
        if(strcmp(argv[i], "-8") == 0) {
            uint8_t search[] = { 0xff, 0x43, 0x00, 0xd1, 0x1f, 0x00, 0x00, 0x71, 0x8a, 0x02, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0xe8, 0x5d, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x6c, 0x02, 0x00, 0x54, 0xe8, 0x7b, 0x1f, 0x32, 0x09, 0x00, 0xbc, 0x52, 0x29, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x8c, 0x02, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0x29, 0x58, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x20, 0x04, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x28, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x21, 0x02, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x1b, 0x00, 0x00, 0x14, 0x80, 0x02, 0x00, 0x35, 0x08, 0x00, 0x80, 0x52, 0x18, 0x00, 0x00, 0x14, 0x08, 0x00, 0xbc, 0x52, 0x08, 0x5e, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc1, 0x01, 0x00, 0x54, 0xe8, 0x73, 0x1d, 0x32, 0x12, 0x00, 0x00, 0x14, 0x09, 0x00, 0xbc, 0x52, 0x49, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xc0, 0x01, 0x00, 0x54, 0x07, 0x00, 0x00, 0x14, 0x08, 0x00, 0xbc, 0x52, 0xc8, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x61, 0x00, 0x00, 0x54, 0xe8, 0x7b, 0x1e, 0x32, 0x07, 0x00, 0x00, 0x14, 0xe0, 0x03, 0x00, 0xf9 };
            void* ent_loc = memmem(kernel_buf, kernel_len, search, sizeof(search) / sizeof(*search));
            if (!ent_loc) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\"\n",__FUNCTION__);
                return -1;
            }
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios8(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, ent_loc));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios8(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, ent_loc));
        }
        if(strcmp(argv[i], "-9") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xff, 0x43, 0x00, 0xd1, 0x1f, 0x24, 0x00, 0x31, 0x8c, 0x02, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0xe8, 0x5d, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x8c, 0x02, 0x00, 0x54, 0xe8, 0x7b, 0x1f, 0x32, 0x09, 0x00, 0xbc, 0x52, 0xa9, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x0c, 0x03, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0x29, 0x58, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x04, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x28, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x41, 0x03, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x1e, 0x00, 0x00, 0x14, 0x1f, 0x20, 0x00, 0x31, 0x21, 0x01, 0x00, 0x54, 0xa8, 0x01, 0x80, 0x12, 0x1a, 0x00, 0x00, 0x14, 0x08, 0x00, 0xbc, 0x52, 0x08, 0x5e, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x01, 0x02, 0x00, 0x54, 0xe8, 0x73, 0x1d, 0x32, 0x14, 0x00, 0x00, 0x14, 0x08, 0x00, 0x80, 0x52, 0x40, 0x02, 0x00, 0x34, 0x0b, 0x00, 0x00, 0x14, 0x09, 0x00, 0xbc, 0x52, 0xc9, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x61, 0x00, 0x00, 0x54, 0xe8, 0x7b, 0x1e, 0x32, 0x0b, 0x00, 0x00, 0x14, 0x09, 0x00, 0xbc, 0x52, 0x49, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xe0, 0x00, 0x00, 0x54 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\"\n",__FUNCTION__);
                return -1;
            }
            uint8_t _debuglog_search[] = { 0xfc, 0x6f, 0xbc, 0xa9, 0xf6, 0x57, 0x01, 0xa9, 0xf4, 0x4f, 0x02, 0xa9, 0xfd, 0x7b, 0x03, 0xa9, 0xfd, 0xc3, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1 };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\"\n",__FUNCTION__);
                return -1;
            }
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios9(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios9(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-10") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xe8, 0x7b, 0x1f, 0x32, 0x09, 0x00, 0xbc, 0x52, 0x29, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xec, 0x01, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0xa9, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xec, 0x02, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0x29, 0x58, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xe0, 0x05, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x28, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa1, 0x03, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x29, 0x00, 0x00, 0x14, 0x1f, 0x24, 0x00, 0x31, 0xac, 0x02, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0x49, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x04, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x08, 0x5e, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x21, 0x02, 0x00, 0x54, 0xe8, 0x73, 0x1d, 0x32, 0x1d, 0x00, 0x00, 0x14, 0x08, 0x00, 0xbc, 0x52, 0xc8, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x02, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x08, 0x5b, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe1, 0x00, 0x00, 0x54, 0xe8, 0x77, 0x1c, 0x32, 0x13, 0x00, 0x00, 0x14, 0x1f, 0x20, 0x00, 0x31, 0x00, 0x02, 0x00, 0x54, 0x08, 0x00, 0x80, 0x52, 0xe0, 0x01, 0x00, 0x34, 0xfd, 0x7b, 0xbf, 0xa9, 0xfd, 0x03, 0x00, 0x91, 0xe0, 0x0f, 0x1f, 0xf8 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 10.0-10.2.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 10.0-10.2.1 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xfc, 0x6f, 0xbc, 0xa9, 0xf6, 0x57, 0x01, 0xa9, 0xf4, 0x4f, 0x02, 0xa9, 0xfd, 0x7b, 0x03, 0xa9, 0xfd, 0xc3, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 10.0-10.2.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 10.0-10.2.1 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios10(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios10(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-103") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0x1f, 0x20, 0x00, 0x31, 0x80, 0x02, 0x00, 0x54, 0x60, 0x03, 0x00, 0x35, 0x08, 0x00, 0x80, 0x52, 0x24, 0x00, 0x00, 0x14, 0x09, 0x00, 0xbc, 0x52, 0x29, 0x58, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x00, 0x04, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x28, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x21, 0x02, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x1a, 0x00, 0x00, 0x14, 0x08, 0x00, 0xbc, 0x52, 0x08, 0x5e, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x01, 0x00, 0x54 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 10.3-10.3.3\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 10.3-10.3.3 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 10.3-10.3.3\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 10.3-10.3.3 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios103(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios10(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-11") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0x08, 0x00, 0xbc, 0x52, 0xe8, 0x5d, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x4d, 0x02, 0x00, 0x54, 0xe8, 0x00, 0xbc, 0x52, 0x68, 0x02, 0x98, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x0c, 0x04, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x08, 0x5e, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa0, 0x06, 0x00, 0x54, 0xe8, 0x00, 0xbc, 0x52, 0x08, 0x01, 0x98, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe0, 0x05, 0x00, 0x54, 0xe8, 0x00, 0xbc, 0x52, 0xc8, 0x01, 0x98, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x05, 0x00, 0x54, 0x30, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1f, 0x32, 0x09, 0x00, 0xbc, 0x52, 0xa9, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x2d, 0x03, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0xc9, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xa0, 0x04, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0x09, 0x5b, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x03, 0x00, 0x54, 0x09, 0x00, 0xbc, 0x52, 0x49, 0x5c, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x05, 0x00, 0x54, 0x1e, 0x00, 0x00, 0x14, 0xe8, 0x00, 0xbc, 0x52, 0x88, 0x02, 0x98, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x00, 0x00, 0x54, 0xe8, 0x00, 0xbc, 0x52, 0xa8, 0x02, 0x98, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x00, 0x02, 0x00, 0x54, 0xa0, 0x02, 0x00, 0x35, 0x08, 0x00, 0x80, 0x52, 0x1e, 0x00, 0x00, 0x14, 0x09, 0x00, 0xbc, 0x52, 0x29, 0x58, 0x80, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x03, 0x00, 0x54, 0x08, 0x00, 0xbc, 0x52, 0x28, 0x59, 0x80, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x61, 0x01, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x14, 0x00, 0x00, 0x14, 0xe8, 0x77, 0x1c, 0x32, 0x12, 0x00, 0x00, 0x14, 0xa8, 0x01, 0x80, 0x12, 0x10, 0x00, 0x00, 0x14, 0xe8, 0x73, 0x1d, 0x32, 0x0e, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1e, 0x32, 0x0c, 0x00, 0x00, 0x14, 0xff, 0x83, 0x00, 0xd1, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xe0, 0x03, 0x00, 0xf9 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 11.0-11.2\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 11.0-11.2 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 11.0-11.2\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 11.0-11.2 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios11(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios11(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-113") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xe8, 0x5d, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x4d, 0x02, 0x00, 0x54, 0x68, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x0c, 0x04, 0x00, 0x54, 0x08, 0x5e, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa0, 0x06, 0x00, 0x54, 0x08, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe0, 0x05, 0x00, 0x54, 0xc8, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x05, 0x00, 0x54, 0x30, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1f, 0x32, 0xa9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x2d, 0x03, 0x00, 0x54, 0xc9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0xa0, 0x04, 0x00, 0x54, 0x09, 0x5b, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x03, 0x00, 0x54, 0x49, 0x5c, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x05, 0x00, 0x54, 0x1e, 0x00, 0x00, 0x14, 0x88, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x00, 0x00, 0x54, 0xa8, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x00, 0x02, 0x00, 0x54, 0xa0, 0x02, 0x00, 0x35, 0x08, 0x00, 0x80, 0x52, 0x1e, 0x00, 0x00, 0x14, 0x29, 0x58, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x03, 0x00, 0x54, 0x28, 0x59, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x61, 0x01, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x14, 0x00, 0x00, 0x14, 0xe8, 0x77, 0x1c, 0x32, 0x12, 0x00, 0x00, 0x14, 0xa8, 0x01, 0x80, 0x12, 0x10, 0x00, 0x00, 0x14, 0xe8, 0x73, 0x1d, 0x32, 0x0e, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1e, 0x32, 0x0c, 0x00, 0x00, 0x14, 0xff, 0x83, 0x00, 0xd1, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xe0, 0x03, 0x00, 0xf9 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 11.3-11.4.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 11.3-11.4.1 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 11.3-11.4.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 11.3-11.4.1 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios11(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios11(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-12") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xe8, 0x5d, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x4d, 0x02, 0x00, 0x54, 0x68, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x0c, 0x04, 0x00, 0x54, 0x08, 0x5e, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x80, 0x06, 0x00, 0x54, 0x08, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x05, 0x00, 0x54, 0xc8, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x00, 0x05, 0x00, 0x54, 0x31, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1f, 0x32, 0xa9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x0d, 0x03, 0x00, 0x54, 0xc9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x04, 0x00, 0x54, 0x09, 0x5b, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x03, 0x00, 0x54, 0x49, 0x5c, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x05, 0x00, 0x54, 0x1f, 0x00, 0x00, 0x14, 0x88, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x03, 0x00, 0x54, 0xa8, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe0, 0x01, 0x00, 0x54, 0x40, 0x04, 0x00, 0x34, 0x15, 0x00, 0x00, 0x14, 0x29, 0x58, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x03, 0x00, 0x54, 0x28, 0x59, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa1, 0x01, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x16, 0x00, 0x00, 0x14, 0xe8, 0x77, 0x1c, 0x32, 0x14, 0x00, 0x00, 0x14, 0xa8, 0x01, 0x80, 0x12, 0x12, 0x00, 0x00, 0x14, 0xe8, 0x73, 0x1d, 0x32, 0x10, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1e, 0x32, 0x0e, 0x00, 0x00, 0x14, 0x08, 0x00, 0x80, 0x52, 0x0c, 0x00, 0x00, 0x14, 0xff, 0x83, 0x00, 0xd1, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xe0, 0x03, 0x00, 0xf9 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 12.0-12.1.2\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 12.0-12.1.2 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 12.0-12.1.2\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 12.0-12.1.2 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios12(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios12(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-122") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xe8, 0x5d, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x4d, 0x02, 0x00, 0x54, 0x68, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x0c, 0x04, 0x00, 0x54, 0x08, 0x5e, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x80, 0x06, 0x00, 0x54, 0x08, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x05, 0x00, 0x54, 0xc8, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x00, 0x05, 0x00, 0x54, 0x31, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1f, 0x32, 0xa9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x0d, 0x03, 0x00, 0x54, 0xc9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x04, 0x00, 0x54, 0x09, 0x5b, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x03, 0x00, 0x54, 0x49, 0x5c, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x05, 0x00, 0x54, 0x1f, 0x00, 0x00, 0x14, 0x88, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x03, 0x00, 0x54, 0xa8, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe0, 0x01, 0x00, 0x54, 0xc0, 0x02, 0x00, 0x35, 0xc0, 0x03, 0x5f, 0xd6, 0x29, 0x58, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x03, 0x00, 0x54, 0x28, 0x59, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa1, 0x01, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x16, 0x00, 0x00, 0x14, 0xe8, 0x77, 0x1c, 0x32, 0x14, 0x00, 0x00, 0x14, 0xa8, 0x01, 0x80, 0x12, 0x12, 0x00, 0x00, 0x14, 0xe8, 0x73, 0x1d, 0x32, 0x10, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1e, 0x32, 0x0e, 0x00, 0x00, 0x14, 0x08, 0x00, 0x80, 0x52, 0x0c, 0x00, 0x00, 0x14, 0xff, 0x83, 0x00, 0xd1, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xe0, 0x03, 0x00, 0xf9 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 12.2-12.5.7\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 12.2-12.5.7 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 12.2-12.5.7\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 12.2-12.5.7 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios12(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios12(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-13") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xe8, 0x5d, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x4d, 0x02, 0x00, 0x54, 0x68, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x0c, 0x04, 0x00, 0x54, 0x08, 0x5e, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x80, 0x06, 0x00, 0x54, 0x08, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x05, 0x00, 0x54, 0xc8, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x00, 0x05, 0x00, 0x54, 0x31, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1f, 0x32, 0xa9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x0d, 0x03, 0x00, 0x54, 0xc9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x04, 0x00, 0x54, 0x09, 0x5b, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x03, 0x00, 0x54, 0x49, 0x5c, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x05, 0x00, 0x54, 0x1f, 0x00, 0x00, 0x14, 0x88, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x03, 0x00, 0x54, 0xa8, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe0, 0x01, 0x00, 0x54, 0xc0, 0x02, 0x00, 0x35, 0xc0, 0x03, 0x5f, 0xd6, 0x29, 0x58, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x03, 0x00, 0x54, 0x28, 0x59, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa1, 0x01, 0x00, 0x54, 0xe8, 0x7b, 0x1c, 0x32, 0x16, 0x00, 0x00, 0x14, 0xe8, 0x77, 0x1c, 0x32, 0x14, 0x00, 0x00, 0x14, 0xa8, 0x01, 0x80, 0x12, 0x12, 0x00, 0x00, 0x14, 0xe8, 0x73, 0x1d, 0x32, 0x10, 0x00, 0x00, 0x14, 0xe8, 0x7b, 0x1e, 0x32, 0x0e, 0x00, 0x00, 0x14, 0x08, 0x00, 0x80, 0x52, 0x0c, 0x00, 0x00, 0x14, 0xff, 0x83, 0x00, 0xd1, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xe0, 0x03, 0x00, 0xf9 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 13.0-13.3.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 13.0-13.3.1 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 13.0-13.3.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 13.0-13.3.1 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios13(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios13(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-134") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xe8, 0x5d, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x4d, 0x02, 0x00, 0x54, 0x68, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x0c, 0x04, 0x00, 0x54, 0x08, 0x5e, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x80, 0x06, 0x00, 0x54, 0x08, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x05, 0x00, 0x54, 0xc8, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x00, 0x05, 0x00, 0x54, 0x31, 0x00, 0x00, 0x14, 0x28, 0x00, 0x80, 0x12, 0xa9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x0d, 0x03, 0x00, 0x54, 0xc9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x04, 0x00, 0x54, 0x09, 0x5b, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x03, 0x00, 0x54, 0x49, 0x5c, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x05, 0x00, 0x54, 0x1f, 0x00, 0x00, 0x14, 0x88, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x03, 0x00, 0x54, 0xa8, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe0, 0x01, 0x00, 0x54, 0xc0, 0x02, 0x00, 0x35, 0xc0, 0x03, 0x5f, 0xd6, 0x29, 0x58, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x03, 0x00, 0x54, 0x28, 0x59, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa1, 0x01, 0x00, 0x54, 0x08, 0x01, 0x80, 0x12, 0x16, 0x00, 0x00, 0x14, 0x88, 0x01, 0x80, 0x12, 0x14, 0x00, 0x00, 0x14, 0xa8, 0x01, 0x80, 0x12, 0x12, 0x00, 0x00, 0x14, 0xe8, 0x00, 0x80, 0x12, 0x10, 0x00, 0x00, 0x14, 0x48, 0x00, 0x80, 0x12, 0x0e, 0x00, 0x00, 0x14, 0x08, 0x00, 0x80, 0x52, 0x0c, 0x00, 0x00, 0x14, 0xff, 0x83, 0x00, 0xd1, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xe0, 0x03, 0x00, 0xf9 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 13.4-13.7\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 13.4-13.7 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 13.4-13.7\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 13.4-13.7 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios13(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios134(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
        if(strcmp(argv[i], "-14") == 0) {
            uint8_t _convertAKSErrorToMKB_search[] = { 0xe8, 0x5d, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x4d, 0x02, 0x00, 0x54, 0x68, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x0c, 0x04, 0x00, 0x54, 0x08, 0x5e, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x80, 0x06, 0x00, 0x54, 0x08, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xc0, 0x05, 0x00, 0x54, 0xc8, 0x01, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x00, 0x05, 0x00, 0x54, 0x31, 0x00, 0x00, 0x14, 0x28, 0x00, 0x80, 0x12, 0xa9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x0d, 0x03, 0x00, 0x54, 0xc9, 0x59, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x04, 0x00, 0x54, 0x09, 0x5b, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x40, 0x03, 0x00, 0x54, 0x49, 0x5c, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x60, 0x05, 0x00, 0x54, 0x1f, 0x00, 0x00, 0x14, 0x88, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0x20, 0x03, 0x00, 0x54, 0xa8, 0x02, 0x98, 0x52, 0xe8, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xe0, 0x01, 0x00, 0x54, 0xc0, 0x02, 0x00, 0x35, 0xc0, 0x03, 0x5f, 0xd6, 0x29, 0x58, 0x80, 0x52, 0x09, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x09, 0x6b, 0x80, 0x03, 0x00, 0x54, 0x28, 0x59, 0x80, 0x52, 0x08, 0x00, 0xbc, 0x72, 0x1f, 0x00, 0x08, 0x6b, 0xa1, 0x01, 0x00, 0x54, 0x08, 0x01, 0x80, 0x12, 0x16, 0x00, 0x00, 0x14, 0x88, 0x01, 0x80, 0x12, 0x14, 0x00, 0x00, 0x14, 0xa8, 0x01, 0x80, 0x12, 0x12, 0x00, 0x00, 0x14, 0xe8, 0x00, 0x80, 0x12, 0x10, 0x00, 0x00, 0x14, 0x48, 0x00, 0x80, 0x12, 0x0e, 0x00, 0x00, 0x14, 0x08, 0x00, 0x80, 0x52, 0x0c, 0x00, 0x00, 0x14, 0xff, 0x83, 0x00, 0xd1, 0xfd, 0x7b, 0x01, 0xa9, 0xfd, 0x43, 0x00, 0x91, 0xe0, 0x03, 0x00, 0xf9 };
            void* _convertAKSErrorToMKB = memmem(kernel_buf, kernel_len, _convertAKSErrorToMKB_search, sizeof(_convertAKSErrorToMKB_search) / sizeof(*_convertAKSErrorToMKB_search));
            if (!_convertAKSErrorToMKB) {
                printf("%s: Could not find \"_convertAKSErrorToMKB\" for 14.0-14.7.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_convertAKSErrorToMKB\" for 14.0-14.7.1 at %p\n", __FUNCTION__,(void*)(_convertAKSErrorToMKB));
            uint8_t _debuglog_search[] = { 0xf6, 0x57, 0xbd, 0xa9, 0xf4, 0x4f, 0x01, 0xa9, 0xfd, 0x7b, 0x02, 0xa9, 0xfd, 0x83, 0x00, 0x91, 0xff, 0x83, 0x20, 0xd1, 0xf3, 0x03, 0x01, 0xaa, 0xf4, 0x03, 0x00, 0xaa };
            void* _debuglog = memmem(kernel_buf+(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)-0xC95C, kernel_len-(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB)+0xC95C, _debuglog_search, sizeof(_debuglog_search) / sizeof(*_debuglog_search));
            if (!_debuglog) {
                printf("%s: Could not find \"_debuglog\" for 14.0-14.7.1\n",__FUNCTION__);
                return -1;
            }
            printf("%s: Found \"_debuglog\" for 14.0-14.7.1 at %p\n", __FUNCTION__,(void*)(_debuglog));
            printf("Kernel: Adding _MKBGetDeviceLockState patch...\n");
            get__MKBGetDeviceLockState_patch_ios14(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
            printf("Kernel: Adding _MKBDeviceUnlockedSinceBoot patch...\n");
            get__MKBDeviceUnlockedSinceBoot_patch_ios14(kernel_buf,kernel_len,(addr_t)GET_OFFSET(kernel_len, _convertAKSErrorToMKB), (addr_t)GET_OFFSET(kernel_len, _debuglog));
        }
    }
    
    term_kernel();
    
    /* Write patched kernel */
    printf("%s: Writing out patched file to %s...\n", __FUNCTION__, argv[2]);
    
    fp = fopen(argv[2], "wb+");
    if(!fp) {
        printf("%s: Unable to open %s!\n", __FUNCTION__, argv[2]);
        free(kernel_buf);
        return -1;
    }
    
    fwrite(kernel_buf, 1, kernel_len, fp);
    fflush(fp);
    fclose(fp);
    
    free(kernel_buf);
    
    printf("%s: Quitting...\n", __FUNCTION__);
    
    return 0;
}
